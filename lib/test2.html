<script>
async function generateKeyPair() {
  return await crypto.subtle.generateKey(
    {
      name: "RSASSA-PKCS1-v1_5",
      modulusLength: 2048,
      publicExponent: new Uint8Array([1, 0, 1]),
      hash: "SHA-256",
    },
    true,
    ["sign", "verify"]
  );
}

async function signMessage(privateKey, message) {
  const encoder = new TextEncoder();
  const data = encoder.encode(message);
  return await crypto.subtle.sign(
    {
      name: "RSASSA-PKCS1-v1_5",
    },
    privateKey,
    data
  );
}

async function verifySignature(publicKey, message, signature) {
  const encoder = new TextEncoder();
  const data = encoder.encode(message);
  return await crypto.subtle.verify(
    {
      name: "RSASSA-PKCS1-v1_5",
    },
    publicKey,
    signature,
    data
  );
}

// 使用例
(async function () {
  const message = "Hello, world!";

  // キーペアを生成
  const { publicKey, privateKey } = await generateKeyPair();

  console.log(publicKey, privateKey)

  // メッセージに署名
  const signature = await signMessage(privateKey, message);
  console.log("Signature:", signature);

  // 署名を検証
  const isValid = await verifySignature(publicKey, message, signature);
  console.log("Signature valid?", isValid);
})();
</script>